"""
서버 사이드 프롬프트 생성 로직.
안전교육과 현장체험학습에 대한 프롬프트를 각각 생성합니다.
"""

# --- 1. 기존 안전교육 프롬프트 생성 로직 ---
ROLE_MAP = {
  'elementary': '초등학생을 위한 친근하고 이해하기 쉬운 언어를 사용하는 안전교육 전문가',
  'middle': '중학생의 눈높이에 맞춰 현실적인 예시를 들어 설명하는 안전교육 교사',
  'high': '고등학생에게 논리적이고 전문적인 정보를 제공하는 안전교육 강사'
}
FORMAT_MAP = {
  'notice': {
    'format': '학부모님께 전달하는 공식 가정통신문',
    'structure': ['정중한 인사말', '안전교육의 중요성 및 주제 소개', '핵심 내용(데이터 기반)', '가정에서의 연계 지도 방법', '학교의 노력 및 당부 말씀', '맺음말']
  },
  'pdf': {
    'format': '학생들이 직접 보고 학습할 수 있는 교육용 자료',
    'structure': ['흥미를 끄는 제목', '학습 목표', '핵심 내용(데이터 기반, 소제목과 목록 활용)', '생각해보기 또는 간단한 활동지', '핵심 내용 요약 및 정리']
  }
}

def build_prompt(school_level, output_type, theme, safety_data):
    """
    안전교육 자료 생성을 위한 프롬프트를 생성합니다.
    """
    role = ROLE_MAP.get(school_level, '안전교육 전문가')
    fmt = FORMAT_MAP.get(output_type, FORMAT_MAP['pdf'])
    theme_ko = "화재 안전" if theme == "fire_safety" else "일반 생활 안전"
    
    prompt = (
        f"당신은 '{role}'입니다. 지금부터 다음 지시사항에 따라 '{fmt['format']}' 형식의 글을 작성해 주세요. 최종 결과물은 반드시 한국어로 작성되어야 합니다.\n\n"
        f"## 주요 정보\n"
        f"- 교육 테마: {theme_ko}\n"
        f"- 교육 대상: {school_level}\n"
        f"- 활용할 데이터: {safety_data}\n\n"
        f"## 작성 구조\n"
        f"글의 전체 구조는 다음 순서를 반드시 따라야 합니다: {', '.join(fmt['structure'])}\n\n"
        f"## 추가 요구사항\n"
        f"- 학생(또는 학부모)의 눈높이에 맞춰 이해하기 쉽게 작성해 주세요.\n"
        f"- '활용할 데이터'에 있는 key_points와 scenarios를 반드시 본문에 자연스럽게 포함시켜 주세요.\n"
        f"- 딱딱한 정보 나열이 아닌, 실제적인 도움이 되는 내용으로 구성해 주세요.\n"
        f"- 결과물은 다른 설명 없이 내용만 나올 수 있도록, HTML 마크업 형식으로 작성해주세요. (예: <h1>제목</h1><p>내용</p><ul><li>항목1</li></ul>)\n"
    )

    if output_type == 'notice':
        prompt += "- 가정통신문이므로 학부모님의 참여와 협조를 유도하는 문구를 포함해 주세요.\n"
    else: # pdf
        prompt += "- 학생들이 흥미를 느낄 수 있도록, 내용과 어울리는 간단한 아이콘이나 이미지에 대한 설명(예: '[이미지: 소화기 그림]')을 포함할 수 있습니다.\n"
        
    prompt += "\n이제 작성을 시작해 주세요."
    return prompt


# --- 2. 신규 현장체험학습 프롬프트 생성 로직 ---
def build_field_trip_prompt(grade, location):
    """
    현장체험학습 교육 자료 생성을 위한 프롬프트를 생성합니다.
    """
    prompt = (
        f"당신은 대한민국 현장체험학습 전문 교사입니다. 다음 지시사항에 따라 '{location}'에 대한 현장체험학습 교육 자료를 작성해 주세요.\n\n"
        f"## 주요 정보\n"
        f"- 대상 학년: {grade}학년\n"
        f"- 체험 장소: {location}\n\n"
        f"## 작성 구조 (아래 순서와 소제목을 반드시 지켜주세요)\n"
        f"1. **장소 소개**: '{location}'이 어떤 곳인지 역사, 특징 등을 포함하여 흥미롭게 소개합니다.\n"
        f"2. **{grade}학년 맞춤 학습 포인트**: 대상 학년의 눈높이에 맞춰, 이 장소에서 무엇을 배우고 느껴야 할지에 대한 핵심 포인트를 3가지 이상 제시합니다.\n"
        f"3. **사전 활동 제안**: 체험학습 전에 학생들이 준비하거나 알아두면 좋을 활동을 2가지 제안합니다.\n"
        f"4. **현장 미션**: 현장에서 학생들이 직접 수행할 수 있는 재미있는 미션이나 질문을 3가지 제시합니다.\n"
        f"5. **활동 후 이야기 나누기**: 체험학습을 다녀온 후, 배운 점을 정리하고 생각을 넓힐 수 있는 질문 2가지를 제시합니다.\n\n"
        f"## 추가 요구사항\n"
        f"- 전체 내용은 학생들이 직접 읽는 자료이므로, 친절하고 이해하기 쉬운 말투로 작성해 주세요.\n"
        f"- 결과물은 다른 부가 설명 없이 내용만 출력되도록, 전체를 HTML 마크업 형식으로 작성해주세요. (예: <h1>{location} 탐방</h1><h2>장소 소개</h2><p>...</p>)\n"
        f"\n이제 작성을 시작해 주세요."
    )
    return prompt
